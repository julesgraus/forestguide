!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callbackMap={},this._argsMap={}}var t,n,a;return t=e,(n=[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];"string"==typeof e?"function"==typeof t?Array.isArray(n)?(this._callbackMap.hasOwnProperty(e)||(this._callbackMap[e]=[]),this._argsMap.hasOwnProperty(e)||(this._argsMap[e]=[]),this._callbackMap[e].push(t),this._argsMap[e].push(n)):console.error("CallbackMapper: not registering callback since the args parameter is not an array"):console.error("CallbackMapper: not registering callback since the callback is not a function"):console.error("CallbackMapper: not registering callback since the action is not a string")}},{key:"trigger",value:function(e){if("string"==typeof e){if(this._callbackMap.hasOwnProperty(e)||this._argsMap.hasOwnProperty(e))for(var t=this._callbackMap[e].length,n=0;n<t;n++)this._callbackMap[e][n].apply(this,this._argsMap[e][n])}else console.error("CallbackMapper: not triggering callback since the action is not a string")}}])&&i(t.prototype,n),a&&i(t,a),e}();function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callbackMapper=new a,this._audio=null,this._requestedPlay=!1,this._ignoreNextPauseForStop=!1,this._urlToLoad=null,this._urlLoaded=!1}var t,n,i;return t=e,(n=[{key:"_enableListeners",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this._audio)return null;this._audio.removeEventListener("loadstart",this._loadStartHandler.bind(this)),this._audio.removeEventListener("durationchange",this._durationChangeHandler.bind(this)),this._audio.removeEventListener("loadedmetadata",this._loadedMetadataHandler.bind(this)),this._audio.removeEventListener("loadeddata",this._loadedDataHandler.bind(this)),this._audio.removeEventListener("progress",this._progressHandler.bind(this)),this._audio.removeEventListener("canplay",this._canPlayHandler.bind(this)),this._audio.removeEventListener("canplayTrough",this._canPlayTroughHandler.bind(this)),this._audio.removeEventListener("error",this._errorHandler.bind(this)),this._audio.removeEventListener("pause",this._pauseHandler.bind(this)),this._audio.removeEventListener("play",this._playHandler.bind(this)),this._audio.removeEventListener("timeupdate",this._timeUpdateHandler.bind(this)),this._audio.removeEventListener("ended",this._endedHandler.bind(this)),e&&(this._audio.addEventListener("loadstart",this._loadStartHandler.bind(this)),this._audio.addEventListener("durationchange",this._durationChangeHandler.bind(this)),this._audio.addEventListener("loadedmetadata",this._loadedMetadataHandler.bind(this)),this._audio.addEventListener("loadeddata",this._loadedDataHandler.bind(this)),this._audio.addEventListener("progress",this._progressHandler.bind(this)),this._audio.addEventListener("canplay",this._canPlayHandler.bind(this)),this._audio.addEventListener("canplayTrough",this._canPlayTroughHandler.bind(this)),this._audio.addEventListener("error",this._errorHandler.bind(this)),this._audio.addEventListener("pause",this._pauseHandler.bind(this)),this._audio.addEventListener("play",this._playHandler.bind(this)),this._audio.addEventListener("timeupdate",this._timeUpdateHandler.bind(this)),this._audio.addEventListener("ended",this._endedHandler.bind(this)))}},{key:"_loadStartHandler",value:function(e){if(!this._audio)return null;this._callbackMapper.trigger("loading")}},{key:"_durationChangeHandler",value:function(e){if(!this._audio)return null}},{key:"_loadedMetadataHandler",value:function(e){if(!this._audio)return null}},{key:"_loadedDataHandler",value:function(e){if(!this._audio)return null}},{key:"_progressHandler",value:function(e){if(!this._audio)return null}},{key:"_canPlayHandler",value:function(e){if(!this._audio)return null;!0===this._requestedPlay&&(this._requestedPlay=!1,this._audio.play(),this._callbackMapper.trigger("play")),this._urlLoaded=!0,this._callbackMapper.trigger("canPlay")}},{key:"_canPlayTroughHandler",value:function(e){if(!this._audio)return null}},{key:"_errorHandler",value:function(e){if(!this._audio)return null;console.error("AudioPlayer:error An error occured: ",this._audio.error)}},{key:"_playHandler",value:function(e){if(!this._audio)return null;this._callbackMapper.trigger("play")}},{key:"_pauseHandler",value:function(e){if(!this._audio)return null;this._ignoreNextPauseForStop?this._ignoreNextPauseForStop=!1:this._callbackMapper.trigger("pause")}},{key:"_timeUpdateHandler",value:function(e){if(!this._audio||!this.isPlaying())return null;this._callbackMapper.trigger("playProgress")}},{key:"_endedHandler",value:function(e){if(!this._audio)return null;this._callbackMapper.trigger("finish")}},{key:"onLoading",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("loading",e,t),this}},{key:"onCanPlay",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("canPlay",e,t),this}},{key:"onPlay",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("play",e,t),this}},{key:"onPause",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("pause",e,t),this}},{key:"onStopped",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("stop",e,t),this}},{key:"onPlayProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("playProgress",e,t),this}},{key:"onFinish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._callbackMapper.on("finish",e,t),this}},{key:"_reset",value:function(){if(!this._audio)return null;this.stop(),this._enableListeners(!1),this._audio=null}},{key:"stop",value:function(){if(!this._audio)return null;this._ignoreNextPauseForStop=!0,this._audio.pause(),this._audio.currentTime=0,this._callbackMapper.trigger("stop")}},{key:"load",value:function(e){this._urlToLoad===e&&!0===this._urlLoaded||(this._urlToLoad=e,"string"==typeof e?(this._reset(),this._audio=new Audio(e),this._enableListeners()):console.error("Player: Could not play the sound because the url wasn't a string."))}},{key:"play",value:function(){if(!this._audio)return null;this._requestedPlay=!0,this._urlLoaded&&this._canPlayHandler(null)}},{key:"pause",value:function(){if(!this._audio)return null;this._audio.pause()}},{key:"setCurrentTime",value:function(e){if(!this._audio)return null;"number"!=typeof e&&console.error("AudioPlayer:setCurrentTime Did not receive a number. It must be the number of seconds you want to play from")}},{key:"getCurrentTime",value:function(){return this._audio?this._audio.currentTime:0}},{key:"isPlaying",value:function(){return!!(this._audio&&this._audio.currentTime>0&&!this._audio.paused&&!this._audio.ended&&this._audio.readyState>2)}}])&&o(t.prototype,n),i&&o(t,i),e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t&&(t={}),this._rootUrl=t.hasOwnProperty("rootUrl")&&"string"==typeof t.rootUrl?t.rootUrl:"forestguide/","/"!==this._rootUrl.substr(this.rootUrl.length-1)&&(this._rootUrl+="/"),this._loadingClass=t.hasOwnProperty("loadingClass")&&"string"==typeof t.loadingClass?t.loadingClass:"loading",this._playingClass=t.hasOwnProperty("playingClass")&&"string"==typeof t.playingClass?t.playingClass:"playing",this._presence_notification_selector=t.hasOwnProperty("presenceNotificationSelector")&&"string"==typeof t.presenceNotificationSelector?t.presenceNotificationSelector:".fgPresenceNotification",this._presence_notification_close_button_selector=t.hasOwnProperty("presenceNotificationCloseButtonSelector")&&"string"==typeof t.presenceNotificationCloseButtonSelector?t.presenceNotificationCloseButtonSelector:".close",this._presence_notification_class_to_remove=t.hasOwnProperty("presenceNotificationClassToRemove")&&"string"==typeof t.presenceNotificationClassToRemove?t.presenceNotificationClassToRemove:"",this._presence_notification_class_to_add=t.hasOwnProperty("presenceNotificationClassToAdd")&&"string"==typeof t.presenceNotificationClassToAdd?t.presenceNotificationClassToAdd:"",this._presence_notification_close_class_to_remove=t.hasOwnProperty("presenceNotificationCloseClassToRemove")&&"string"==typeof t.presenceNotificationCloseClassToRemove?t.presenceNotificationCloseClassToRemove:"",this._presence_notification_close_class_to_add=t.hasOwnProperty("presenceNotificationCloseClassToAdd")&&"string"==typeof t.presenceNotificationCloseClassToAdd?t.presenceNotificationCloseClassToAdd:""}var t,n,i;return t=e,(n=[{key:"rootUrl",get:function(){return this._rootUrl}},{key:"loadingClass",get:function(){return this._loadingClass}},{key:"playingClass",get:function(){return this._playingClass}},{key:"presenceNotificationSelector",get:function(){return this._presence_notification_selector}},{key:"presenceNotificationCloseButtonSelector",get:function(){return this._presence_notification_close_button_selector}},{key:"presenceNotificationCloseClassToRemove",get:function(){return this._presence_notification_close_class_to_remove}},{key:"presenceNotificationCloseClassToAdd",get:function(){return this._presence_notification_close_class_to_add}},{key:"presenceNotificationClassToRemove",get:function(){return this._presence_notification_class_to_remove}},{key:"presenceNotificationClassToAdd",get:function(){return this._presence_notification_class_to_add}}])&&s(t.prototype,n),i&&s(t,i),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._headers={},this._request=null,this._username=null,this._password=null,this._responseType="text"}var t,n,i;return t=e,(n=[{key:"_init",value:function(){return this._request=new XMLHttpRequest,this}},{key:"_open",value:function(e,t){if("string"==typeof e)if("string"==typeof t){for(var n in this._request.open(e.toUpperCase(),t,!0,self._username,self._password),self._headers)self._headers.hasOwnProperty(n)&&this._request.setRequestHeader(n,self._headers[n]);this._request.responseType=this._responseType}else console.error("DataRetriever:_open The url must be a string");else console.error("DataRetriever:_open The method must be a string")}},{key:"_send",value:function(e,t){var n=this;this._request.onreadystatechange=function(){switch(n._request.readyState){case XMLHttpRequest.UNSENT:case XMLHttpRequest.OPENED:case XMLHttpRequest.HEADERS_RECEIVED:case XMLHttpRequest.LOADING:break;case XMLHttpRequest.DONE:switch(n._request.status){case 200:e.call(n,n._request.response);break;default:t.call(n,n._request.statusText)}}},this._request.send()}},{key:"setResponseType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",t=["text","arraybuffer","blob","document"];"string"==typeof e&&-1!==t.indexOf(e)||console.log("Dataretriever:setResponseType: The type was not valid. It must be one of these: "+t.join(", ")),this._responseType=e}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"setHeader",value:function(e,t){return this._headers[e]=t,this}},{key:"get",value:function(e){var t=this;return"string"!=typeof e?(console.error("DataRetriever:get The url must be a string"),Promise.reject("DataRetriever:get The url must be a string")):new Promise((function(n,i){t._init(),t._open("GET",e),t._send(n,i)}))}},{key:"username",set:function(e){"string"==typeof e?this._username=e:console.error("DataRetriever:setUsername The username must be a string")}},{key:"password",set:function(e){"string"==typeof e?this._password=e:console.error("DataRetriever:setPassword The password must be a string")}}])&&c(t.prototype,n),i&&c(t,i),e}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name="",this._options={},this._instance=null}var t,n,i;return t=e,i=[{key:"fromJson",value:function(t){var n=e.validate(t);if(!0!==n)return console.error(n),null;var i=new e;return i._name=t.name,i._options=t.options,i}},{key:"validate",value:function(e){return void 0===e?"Action: The action is not valid because it was undefined":e.hasOwnProperty("name")&&"string"==typeof e.name?!(!e.hasOwnProperty("options")||"object"!==d(e.options))||"Action: The action was not valid. It must contain an object property called options":"Action: The action was not valid. It must contain a string property called name"}}],(n=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}}])&&f(t.prototype,n),i&&f(t,i),e}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._start=0,this._end=0,this._actions=[]}var t,n,i;return t=e,i=[{key:"fromJson",value:function(t){var n=e.validate(t);if(!0!==n)return console.error(n),null;var i=new e;return i._start=t.start,i._end=t.end,i._actions=t.actions,i}},{key:"validate",value:function(e){if(void 0===e)return"Cue: The cue is not valid because it was undefined";if(!e.hasOwnProperty("start")||"number"!=typeof e.start)return"Cue: The cue was not valid. It must contain a number property called start";if(!e.hasOwnProperty("end")||"number"!=typeof e.end)return"Cue: The cue was not valid. It must contain a number property called end";if(!e.hasOwnProperty("actions")||!Array.isArray(e.actions))return"Cue: The cue was not valid. It must contain an array property called actions";for(var t=e.actions.length,n=0;n<t;n++){var i=e.actions[n],a=h.validate(i);if(!0!==a)return a}return!0}}],(n=[{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"selector",get:function(){return this._selector}},{key:"actions",get:function(){return this._actions}}])&&p(t.prototype,n),i&&p(t,i),e}();function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._soundFile="",this._cues=[]}var t,n,i;return t=e,i=[{key:"fromJson",value:function(t){var n=e.validate(t);if(!0!==n)return console.error(n),null;var i=new e;return i._soundFile=t.soundFile,i._cues=t.cues,i}},{key:"validate",value:function(e){if(void 0===e)return"Guide: The guide is not valid because it was undefined";if(!e.hasOwnProperty("soundFile")||"string"!=typeof e.soundFile)return"Guide: The guide is not valid. It must have a string property called soundFile.";if(!e.hasOwnProperty("cues")||!Array.isArray(e.cues))return"Guide: The guide is not valid. It must have an array property called 'cues'";for(var t=e.cues.length,n=0;n<t;n++){var i=e.cues[n],a=_.validate(i);if(!0!==a)return a}return!0}}],(n=[{key:"soundFile",get:function(){return this._soundFile}},{key:"cues",get:function(){return this._cues}}])&&v(t.prototype,n),i&&v(t,i),e}();function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"activate",value:function(t){var n=e._validateOptions(t);if(!n)return!1;document.querySelectorAll(n.selector).forEach((function(e){e.classList.contains(n.class)||e.classList.add(n.class)}))}},{key:"deactivate",value:function(t){var n=e._validateOptions(t);if(!n)return!1;document.querySelectorAll(n.selector).forEach((function(e){e.classList.remove(n.class)}))}},{key:"_validateOptions",value:function(e){return"object"!==g(e)?(console.error("AddClass: The options parameter was not an expected object."),!1):e.hasOwnProperty("selector")&&"string"==typeof e.selector?(e.hasOwnProperty("class")&&"string"==typeof e.selector||(e.class="fg-blink-border"),e):(console.error("AddClass: The options object does not have an string property called selector"),!1)}}],(n=null)&&b(t.prototype,n),i&&b(t,i),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"activate",value:function(t){var n=e._validateOptions(t);if(!n)return!1;var i=document.querySelector(n.selector);if(!i)return!1;i.scrollIntoView({behavior:t.behaviour,block:t.vertical_alignment,inline:t.horizontal_alignment})}},{key:"deactivate",value:function(e){}},{key:"_validateOptions",value:function(e){return"object"!==k(e)?(console.error("ScrollToElement: The options parameter was not an expected object."),!1):e.hasOwnProperty("selector")&&"string"==typeof e.selector?(e.hasOwnProperty("behavior")&&"string"==typeof e.behavior||(e.behaviour="smooth"),-1===["smooth","auto"].indexOf(e.behavior)&&(e.behaviour="smooth"),e.hasOwnProperty("horizontal_alignment")&&"string"==typeof e.horizontal_alignment||(e.horizontal_alignment="nearest"),-1===["start","center","end","nearest"].indexOf(e.horizontal_alignment)&&(e.horizontal_alignment="nearest"),e.hasOwnProperty("vertical_alignment")&&"string"==typeof e.vertical_alignment||(e.vertical_alignment="center"),-1===["start","center","end","nearest"].indexOf(e.vertical_alignment)&&(e.horizontal_alignment="center"),e):(console.error("ScrollToElement: The options object does not have an string property called selector"),!1)}}],(n=null)&&C(t.prototype,n),i&&C(t,i),e}();function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"_do",value:function(e,t,n){switch(e.toLowerCase()){case"addclass":if(!this._verifyAction(m,"AddClass"))break;m[n](t);break;case"scrolltoelement":if(!this._verifyAction(w,"scrollToElement"))break;w[n](t)}}},{key:"activate",value:function(e){this._do(e.name,e.options,"activate")}},{key:"deactivate",value:function(e){this._do(e.name,e.options,"deactivate")}},{key:"_verifyAction",value:function(e,t){return e.hasOwnProperty("activate")&&e.hasOwnProperty("deactivate")&&"function"==typeof e.activate&&"function"==typeof e.deactivate?e:(console.error('ActionFactory: The action called "'+t+'" was not really an action because it did not have both the activate and deactivate methods.'),!1)}}])&&T(t.prototype,n),i&&T(t,i),e}();function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._guide=null,this._activeCueIds=[],this._cueIdsToActivate=[],this._cueIdsToDeactivate=[],this._activator=new P}var t,n,i;return t=e,(n=[{key:"loadGuide",value:function(e){!e instanceof y?console.error("The actionprocessor only accepts an instance of the Guide class. Something else was given"):this._guide=e}},{key:"deactivate",value:function(){self=this,this._cueIdsToActivate=[],this._cueIdsToDeactivate=[],this._activeCueIds.forEach((function(e){self._cueIdsToDeactivate.push(e)})),this._deactivateCues(),this._activeCueIds=[],this._cueIdsToDeactivate=[]}},{key:"tick",value:function(e){if(this._guide){var t=this;this._guide.cues.forEach((function(n,i){var a=t._activeCueIds.indexOf(i),o=t._cueIdsToActivate.indexOf(i),r=t._cueIdsToDeactivate.indexOf(i);if(e>=n.start&&e<=n.end){if(-1!==a||-1!==o||-1!==r)return;t._cueIdsToActivate.push(i)}else if(e>n.end||e<n.start){if(-1===a||-1!==r)return;t._cueIdsToDeactivate.push(i)}})),this._deactivateCues(),this._activateCues()}}},{key:"_activateCues",value:function(){for(var e,t=this;"number"==typeof(e=this._cueIdsToActivate.pop());)t._guide.cues[e].actions.forEach((function(e){t._activateAction(e)})),t._activeCueIds.push(e)}},{key:"_deactivateCues",value:function(){for(var e,t=this;"number"==typeof(e=this._cueIdsToDeactivate.pop());)t._guide.cues[e].actions.forEach((function(e){t._deactivateAction(e)})),t._activeCueIds.splice(t._activeCueIds.indexOf(e),1)}},{key:"_activateAction",value:function(e){this._activator.activate(e)}},{key:"_deactivateAction",value:function(e){this._activator.deactivate(e)}}])&&O(t.prototype,n),i&&O(t,i),e}();function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var N=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"get",value:function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null}},{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new Date;i.setTime(i.getTime()+(n?864e5*n:"9999999999")),document.cookie=e+"="+t+";path=/;expires="+i.toGMTString()}},{key:"delete",value:function(e){this.setCookie(e,"",-1)}}])&&E(t.prototype,n),i&&E(t,i),e}();function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"default",(function(){return A}));var A=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dataRetriever=new u,this._config=new l(t),this._audioPlayer=new r,this._actionProcessor=new L,this._cookies=new N,this._guideDataAttributeName="forest-guide",this._camelCasedGuideDataAttributeName="forestGuide",this._presenceNotificationCookieName="presence_notification_closed",this._guideButtons=null,this._initializeGuideButtons(),this._addListenersToPresenceNotifications(),this._initializePresenceNotificationClasses()}var t,n,i;return t=e,(n=[{key:"_initializeGuideButtons",value:function(){var e=this,t="[data-"+this._guideDataAttributeName+"]";this._guideButtons=document.querySelectorAll(t),this._guideButtons.forEach((function(t){t.addEventListener("click",e._guideButtonClicked.bind(e))}))}},{key:"_guideButtonClicked",value:function(e){var t=this,n=e.target;e.preventDefault(),!this._guideDataAttributeName in n.dataset&&console.error('Could process a click on a ForestGuide guide button since it did not contain the data attribute "data-'+this._guideDataAttributeName+'" anymore.');var i=n.dataset[this._camelCasedGuideDataAttributeName];this._dataRetriever.get(this._config.rootUrl+i+".json").then((function(e){var a={};try{a=JSON.parse(e)}catch(e){return void console.error('ForestGuide: The json as denoted in the guide "'+i+'" was invalid. '+e.message)}var o=y.fromJson(a);t._startOrStopGuidance(o,n)})).catch((function(e){console.error('ForestGuide: Could not retrieve guide "'+i+'" because of an error: '+e)}))}},{key:"_startOrStopGuidance",value:function(e,t){var n=this;n._actionProcessor.loadGuide(e),!1===this._audioPlayer.isPlaying()?(this._audioPlayer.onLoading((function(){t.classList.add(n._config.loadingClass),t.classList.remove(n._config.playingClass)})).onPlay((function(){t.classList.remove(n._config.loadingClass),t.classList.add(n._config.playingClass)})).onPause((function(){t.classList.remove(n._config.loadingClass),t.classList.remove(n._config.playingClass),n._actionProcessor.deactivate()})).onPlayProgress((function(){n._actionProcessor.tick(n._audioPlayer.getCurrentTime())})).onFinish((function(){t.classList.remove(n._config.loadingClass),t.classList.remove(n._config.playingClass)})).onStopped((function(){t.classList.remove(n._config.loadingClass),t.classList.remove(n._config.playingClass),n._actionProcessor.deactivate()})),this._audioPlayer.load(this._config.rootUrl+e.soundFile),this._audioPlayer.play()):this._audioPlayer.stop()}},{key:"_addListenersToPresenceNotifications",value:function(){var e=this;document.querySelectorAll(this._config.presenceNotificationSelector).forEach((function(t){var n=t.querySelector(e._config.presenceNotificationCloseButtonSelector);n&&(console.log("add click handler"),n.addEventListener("click",(function(){""!==e._config.presenceNotificationCloseClassToAdd&&t.classList.add(e._config.presenceNotificationCloseClassToAdd),""===e._config.presenceNotificationCloseClassToRemove&&t.parentElement?t.parentElement.removeChild(t):t.classList.remove(e._config.presenceNotificationCloseClassToRemove),e._cookies.set(e._presenceNotificationCookieName,1,null)})))}))}},{key:"_initializePresenceNotificationClasses",value:function(){var e=this,t=document.querySelectorAll(this._config.presenceNotificationSelector);this._cookies.get(this._presenceNotificationCookieName)?console.info("already notified the user that forest guide is present. Not adding or removing classes to notifications"):t.forEach((function(t){""!==e._config.presenceNotificationClassToAdd&&t.classList.add(e._config.presenceNotificationClassToAdd),""!==e._config.presenceNotificationClassToRemove&&t.classList.remove(e._config.presenceNotificationClassToRemove)}))}}])&&S(t.prototype,n),i&&S(t,i),e}();window.ForestGuide=A}]);